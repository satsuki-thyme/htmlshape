function htmlshape(e,p){let g="  ";void 0!==p&&(g=String.raw(p));let $=".*?>",r="address|article|aside|blockquote|(?<!t)body|details|dialog|div|dl|fieldset|figcaption|figure|footer|form|(?<!t)head(?!er)|header|hgroup|hr|html|main|nav|ol|p(?!re)|pre|section|table|tbody|thead|tr|ul",t="code|dd|dt|h1|h2|h3|h4|h5|h6|li|td|th",n="!DOCTYPE html|meta",l="br",a="script|style",s=new RegExp(`\\s*(<(?:${r}|${t}|${n}|${l})${$})\\s*`,"g"),o=new RegExp(`\\s*(<(?:${a})${$})\\s*`,"g"),c=new RegExp("\\s*(<!--.*)","g"),d=new RegExp(`\\s*(<\\/(?:${r}|${t})${$})\\s*`,"g"),h=new RegExp(`\\s*(<\\/(?:${a})${$})\\s*`,"g"),i=new RegExp("(.*?-->)\\s*","g"),u=new RegExp(`\\s*(<${l} ?/?>)\\s*`),x=new RegExp(`(<(?:${r}|${t}|${n}|${a})${$})`,"g"),w=new RegExp("(<!--.*)","g"),E=new RegExp(`(<\\/(?:${r})${$})`,"g"),R=new RegExp(`(<${l} ?/?>)`,"g"),m=new RegExp(`(<(?:${r})${$})(?:(?!<(?:${r}|${t})${$})(.+))`,"g"),f=e.replace(s,"$1").replace(o,"$1").replace(c,"$1").replace(d,"$1").replace(h,"$1").replace(i,"$1").replace(u,"$1").replace(x,"\n$1").replace(w,"\n$1").replace(E,"\n$1").replace(R,"$1\n").replace(m,"$1\n$2").split(/\r?\n/),b=0,v=[],y=new RegExp(`^<(?<end>\\/?)(?<tag>${r})${$}`),P=!1;return new Promise(e=>{function p(){let $=f[b].match(y);$?("pre"===$.groups.tag&&""===$.groups.end?(P=!0,v.push($.groups.tag)):"pre"===$.groups.tag&&"/"===$.groups.end&&(P=!1,v.splice(-1,1)),!1===P&&""===$.groups.end?(f[b]=`${g.repeat(v.length)}${f[b]}`,v.push($.groups.tag)):!1===P&&"/"===$.groups.end?(v.splice(-1,1),!1===P&&(f[b]=`${g.repeat(v.length)}${f[b]}`)):!0===P&&"code"===$.groups.tag&&(f[b]=`${g.repeat(v.length)}${f[b]}`)):!1===P&&(f[b]=`${g.repeat(v.length)}${f[b]}`),b<f.length-1?(b++,p()):e(f.splice(1,f.length-1).join("\n"))}p()})}