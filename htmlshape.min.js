function htmlShape(e,$){let n="  ";void 0!==$&&(n=String.raw($));let p=".*?>",g="address|article|aside|blockquote|body|details|dialog|div|dl|fieldset|figcaption|figure|footer|form|head|header|hgroup|hr|html|main|nav|ol|p|pre|section|table|ul",l="dd|dt|h1|h2|h3|h4|h5|h6|li|td",r="!DOCTYPE html|meta",t="br",a="script|style",s=new RegExp(`\\s*(<(?:${g}|${l}|${r}|${t})${p})\\s*`,"g"),c=new RegExp(`\\s*(<(?:${a})${p})`,"g"),i=new RegExp("\\s*(<!--.*)","g"),h=new RegExp(`\\s*(<\\/(?:${g}|${l})${p})\\s*`,"g"),d=new RegExp(`\\s*(<\\/(?:${a})${p})\\s*`,"g"),o=new RegExp("(.*?-->)\\s*","g"),x=new RegExp(`\\s*(<${t} ?/?>)\\s*`),w=new RegExp(`(<(?:${g}|${l}|${r}|${a})${p})`,"g"),E=new RegExp("(<!--.*)","g"),R=new RegExp(`(<\\/(?:${g})${p})`,"g"),u=new RegExp(`(<${t} ?/?>)`,"g"),m=new RegExp(`^(<(?:${g})${p})((?!<(?:${g})${p}).*)`,"gm"),f=e.replace(s,"$1").replace(c,"$1").replace(i,"$1").replace(h,"$1").replace(d,"\n$1").replace(o,"$1").replace(x,"$1").replace(w,"\n$1").replace(E,"\n$1").replace(R,"\n$1").replace(u,"$1\n").replace(m,"$1\n$2").split(/\r?\n/),b=0,v=[],y=new RegExp(`^<(?<end>\\/?)(?<tag>${g})${p}`);return new Promise(e=>{function $(){let p=f[b].match(y);null!==p?""===p.groups.end?(f[b]=`${n.repeat(v.length)}${f[b]}`,v.push(p.groups.tag)):"/"===p.groups.end&&(v.splice(-1,1),f[b]=`${n.repeat(v.length)}${f[b]}`):f[b]=`${n.repeat(v.length)}${f[b]}`,b<f.length-1?(b++,$()):e(f.splice(1,f.length-1).join("\n"))}$()})}