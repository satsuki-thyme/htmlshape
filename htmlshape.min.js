function htmlshape(e,p){let $="  ";void 0!==p&&($=String.raw(p));let g=".*?>",n="address|article|aside|blockquote|body|details|dialog|div|dl|fieldset|figcaption|figure|footer|form|head|header|hgroup|hr|html|main|nav|ol|p|pre|section|table|tbody|thead|tr|ul",t="dd|dt|h1|h2|h3|h4|h5|h6|li|td|th",r="!DOCTYPE html|meta",l="br",a="script|style",s=new RegExp(`\\s*(<(?:${n}|${t}|${r}|${l})${g})\\s*`,"g"),c=new RegExp(`\\s*(<(?:${a})${g})`,"g"),h=new RegExp("\\s*(<!--.*)","g"),d=new RegExp(`\\s*(<\\/(?:${n}|${t})${g})\\s*`,"g"),i=new RegExp(`\\s*(<\\/(?:${a})${g})\\s*`,"g"),o=new RegExp("(.*?-->)\\s*","g"),x=new RegExp(`\\s*(<${l} ?/?>)\\s*`),w=new RegExp(`(<(?:${n}|${t}|${r}|${a})${g})`,"g"),E=new RegExp("(<!--.*)","g"),u=new RegExp(`(<\\/(?:${n})${g})`,"g"),R=new RegExp(`(<${l} ?/?>)`,"g"),m=new RegExp(`(<(?:${n})${g})(.+)`,"g"),f=e.replace(s,"$1").replace(c,"$1").replace(h,"$1").replace(d,"$1").replace(i,"$1").replace(o,"$1").replace(x,"$1").replace(w,"\n$1").replace(E,"\n$1").replace(u,"\n$1").replace(R,"$1\n").replace(m,"$1\n$2").split(/\r?\n/),b=0,v=[],y=new RegExp(`^<(?<end>\\/?)(?<tag>${n})${g}`),P=!1;return new Promise(e=>{function p(){let g=f[b].match(y);g?("pre"===g.groups.tag&&""===g.groups.end&&(P=!0),""===g.groups.end?(f[b]=`${$.repeat(v.length)}${f[b]}`,v.push(g.groups.tag)):"/"===g.groups.end&&(v.splice(-1,1),!1===P?f[b]=`${$.repeat(v.length)}${f[b]}`:P=!1)):!1===P&&(f[b]=`${$.repeat(v.length)}${f[b]}`),b<f.length-1?(b++,p()):e(f.splice(1,f.length-1).join("\n"))}p()})}